<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GREKO ‚Äî –°—É–ø–æ–≤—ã–π –∫–ª–∏–∫–µ—Ä –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ</title>
<style>
  :root{
    --bg1:#071428; --bg2:#0b1f3f;
    --card:#0e1f3d; --line:#274170;
    --ink:#eaf2ff; --muted:#9fb3d8;
    --accent:#73f0ff; --accent2:#9affb1; --gold:#ffd36d;
    --ok:#32d39c; --warn:#ff9b7c; --danger:#ff5670;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink); font:16px/1.45 system-ui,Segoe UI,Roboto,Arial;
    background:
      radial-gradient(1200px 700px at 70% -10%, #19335e 0%, transparent 60%),
      radial-gradient(900px 500px at -10% 30%, #132a4f 0%, transparent 60%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    background-attachment:fixed;
    overflow-x:hidden;
  }
  header{
    display:flex; align-items:center; justify-content:space-between; gap:16px;
    padding:14px 16px; border-bottom:1px solid var(--line);
  }
  .title{display:flex; gap:12px; align-items:center}
  .logo{width:46px;height:46px;border-radius:12px;
    background:
      radial-gradient(circle at 35% 35%, #ffd36d 0 40%, #b65c00 42% 48%, transparent 50%),
      conic-gradient(#ffaa00,#ff7b00,#ff4d00,#ffaa00);
    box-shadow:0 0 22px rgba(255,209,109,.35), 0 6px 18px #0008; border:1px solid #ffb13f66;
  }
  h1{margin:0;font-size:18px;letter-spacing:.3px}
  .sub{font-size:12px;color:var(--muted)}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:16px}
  .card{background:var(--card); border:1px solid var(--line); border-radius:16px; padding:14px; box-shadow:0 8px 28px #0007}
  h2{margin:0 0 8px;font-size:16px}
  .stats{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
  .pill{background:linear-gradient(180deg,#0f1f3e,#0b1730); border:1px solid var(--line); border-radius:12px; padding:10px}
  .cap{font-size:12px;color:var(--muted)}
  .val{font-weight:800;font-size:18px;margin-top:2px}
  .hint{color:var(--muted);font-size:12px}
  .bar{height:12px;background:#0b1730;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .bar > i{display:block;height:100%; background:linear-gradient(90deg,var(--accent),#58ffa3)}
  .bar.warn > i{background:linear-gradient(90deg,#ffb37b,#ff6b6b)}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  button{
    cursor:pointer;border:1px solid var(--line);background:#0d1830;color:var(--ink);
    padding:10px 12px;border-radius:12px;font-weight:700;transition:.15s transform,.15s opacity,.15s filter;
    box-shadow:0 2px 10px #0006
  }
  button:hover{transform:translateY(-1px)}
  button:disabled{opacity:.55;cursor:not-allowed;transform:none}
  .btn-acc{background:#0c2232;border-color:#1c405a}
  .btn-warn{background:#2c1620;border-color:#5a2942}
  .btn-ok{background:#11281f;border-color:#2f5a41}
  .cost{font-weight:700;color:var(--muted);font-size:12px;margin-left:6px}

  /* –ù–µ–æ–Ω–æ–≤–∞—è –≤—ã–≤–µ—Å–∫–∞ GREKO */
  .neon{
    text-shadow:
      0 0 6px rgba(115,240,255,.8),
      0 0 18px rgba(115,240,255,.6),
      0 0 36px rgba(115,240,255,.4);
    color:var(--accent);
    letter-spacing:2px;
    animation:glow 3s ease-in-out infinite;
    font-weight:900;
  }
  @keyframes glow{
    0%,100%{filter:drop-shadow(0 0 0 rgba(115,240,255,.5))}
    50%{filter:drop-shadow(0 0 12px rgba(115,240,255,.7))}
  }

  /* –°—Ü–µ–Ω–∞ –∫—É—Ö–Ω–∏: –∫–∞—Å—Ç—Ä—é–ª—è —Å –ø—É–∑—ã—Ä—å–∫–∞–º–∏ –∏ –ø–∞—Ä–æ–º */
  .kitchen{
    position:relative; height:280px; border:1px dashed #2a3f69; border-radius:14px; overflow:hidden;
    background:
      radial-gradient(300px 120px at 50% 110%, #0b1a33 0, transparent 70%),
      linear-gradient(#0b1f3d,#0b1a33);
  }
  .pot{
    position:absolute; left:50%; bottom:22px; width:320px; height:140px; transform:translateX(-50%);
    border-radius:22px 22px 34px 34px; background:linear-gradient(180deg,#1a2f55,#0f1d3a);
    border:2px solid #2b4a82; box-shadow:inset 0 -12px 30px #0008, 0 10px 20px #0009;
  }
  .pot:before{
    content:''; position:absolute; left:-10px; right:-10px; top:-14px; height:22px; border-radius:18px;
    background:linear-gradient(180deg,#203c6e,#102547); border:2px solid #2b4a82;
  }
  .steam{
    position:absolute; left:50%; bottom:180px; width:200px; height:150px; transform:translateX(-50%);
    pointer-events:none;
    background:
      radial-gradient(60px 40px at 50% 100%, rgba(255,255,255,.15), transparent 60%),
      radial-gradient(70px 50px at 30% 100%, rgba(255,255,255,.12), transparent 60%),
      radial-gradient(70px 50px at 70% 100%, rgba(255,255,255,.12), transparent 60%);
    animation:steam 3.6s ease-in-out infinite;
    filter:blur(1px);
  }
  @keyframes steam{
    0%{transform:translate(-50%,0) scale(1);opacity:.6}
    100%{transform:translate(-50%,-40px) scale(1.2);opacity:.05}
  }
  .bubble{
    position:absolute; bottom:40px; left:50%; width:10px; height:10px; border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #bff 0,#69a 50%,#235 80%);
    opacity:.9; animation:rise 2.4s ease-out infinite;
  }
  @keyframes rise{
    0%{transform:translate(-50%,0) scale(.8);opacity:.0}
    10%{opacity:.9}
    100%{transform:translate(calc(-50% + var(--x,0px)),-110px) scale(1.4);opacity:0}
  }
  .shake{animation:shake .3s linear 1}
  @keyframes shake{
    0%,100%{transform:translateX(0)}
    20%{transform:translateX(-3px)}
    40%{transform:translateX(3px)}
    60%{transform:translateX(-2px)}
    80%{transform:translateX(2px)}
  }
  .toast{
    position:fixed; left:50%; top:18px; transform:translateX(-50%);
    background:#0b1830; border:1px solid var(--line); padding:10px 14px; border-radius:12px;
    font-weight:700; box-shadow:0 10px 30px #0009; opacity:0; pointer-events:none;
    transition:.3s opacity, .3s transform;
  }
  .toast.show{opacity:1; transform:translateX(-50%) translateY(4px)}
  .log{font-family:ui-monospace,Consolas,monospace;font-size:13px;white-space:pre-line;max-height:240px;overflow:auto;padding:10px;border:1px solid var(--line);border-radius:12px;background:#0a1426}
  .tag{padding:4px 8px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:#c6d6f5}
  .right .card{height:100%}
  .footer{padding:12px 0 28px;text-align:center;color:#8aa4cb;font-size:12px}
  .kbd{border:1px solid #2b3e65;border-radius:6px;padding:.5px 6px;background:#0b1730}

  /* –º–æ–¥–∞–ª–∫–∞ */
  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(6,10,20,.65);backdrop-filter:blur(3px)}
  .box{max-width:560px;background:#0e1f3d;border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:0 16px 44px #000a}
  .box h3{margin:.2rem 0 .4rem}
  .win{color:#9fffd1} .danger{color:#ff8e8e}
</style>
</head>
<body>
<header>
  <div class="title">
    <div class="logo"></div>
    <div>
      <h1 class="neon">GREKO ‚Ä¢ –°–£–ü–û–í–´–ô –ö–õ–ò–ö–ï–†</h1>
      <div class="sub">–†–µ—Å—Ç–æ—Ä–∞–Ω GREKO: –º—ã –ª—é–±–∏–º –æ–ª–∏–≤–∫–∏, —á–µ—Å–Ω–æ–∫ –∏ —Å–∞—Ä–∫–∞–∑–º. –ö–ª–∏–∫–∞–µ—à—å ‚Äî –º–µ—à–∞–µ—à—å —Å—É–ø, —Ä–∞—Å—Ç–∏—à—å —Å–ª–∞–≤—É. –°—Ç–∞—Ä–∞–π—Å—è –Ω–µ –≤–æ–Ω—è—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–∞—Å –∑–∞–∫—Ä—ã–ª–∏.</div>
    </div>
  </div>
  <div class="row">
    <button id="btn-pause" class="btn-acc">–ü–∞—É–∑–∞</button>
    <button id="btn-reset" class="btn-warn" title="–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ">–°–±—Ä–æ—Å</button>
  </div>
</header>

<div class="wrap">
  <div class="stats">
    <div class="pill"><div class="cap">–ë—É–ª—å–æ–Ω</div><div class="val" id="st-broth">0</div><div class="hint" id="rate-broth">+0/–∫–ª–∏–∫ ‚Ä¢ +0/—Å</div></div>
    <div class="pill"><div class="cap">–ó–∞–ø–∞—Ö</div><div class="val" id="st-smell">0%</div><div class="bar warn"><i id="bar-smell" style="width:0%"></i></div></div>
    <div class="pill"><div class="cap">–†–∏—Å–∫</div><div class="val" id="st-risk">0%</div><div class="bar warn"><i id="bar-risk" style="width:0%"></i></div></div>
    <div class="pill"><div class="cap">–°–ª–∞–≤–∞ GREKO</div><div class="val" id="st-fame">0</div><div class="bar"><i id="bar-fame" style="width:0%"></i></div></div>
    <div class="pill"><div class="cap">–ê–ø–≥—Ä–µ–π–¥—ã</div><div class="val" id="st-upg">0</div><div class="hint">–ï—â—ë –±–æ–ª—å—à–µ –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ–π –≥–æ—Ä–¥–æ—Å—Ç–∏</div></div>
    <div class="pill"><div class="cap">–°–æ–±—ã—Ç–∏—è</div><div class="val" id="st-events">0</div><div class="hint">–°–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ ‚Äî –Ω–∞—à–∞ —Å–ø–µ—Ü–∏—è</div></div>
  </div>

  <div class="grid">
    <div class="left">
      <div class="card">
        <h2>–ö—É—Ö–Ω—è GREKO</h2>
        <div class="kitchen" id="stage">
          <div class="steam"></div>
          <div class="pot" id="pot"></div>
          <!-- –ø—É–∑—ã—Ä—å–∫–∏ –≥–µ–Ω–µ—Ä—è—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
        </div>
        <div class="row" style="margin-top:12px">
          <button id="btn-stir" class="btn-ok" style="font-size:18px">ü•Ñ –ü–æ–º–µ—à–∞—Ç—å —Å—É–ø</button>
          <button id="btn-enz" class="btn-acc" title="–ö–æ—Ä–æ—Ç–∫–∏–π –±—É—Å—Ç, –Ω–æ –∑–∞–ø–∞—Ö –≤—ã—Ä–∞—Å—Ç–µ—Ç">–≠–Ω–∑–∏–º–Ω–∞—è —Ä–∞—Å–∫–∞—á–∫–∞: –≤—ã–∫–ª</button>
          <span class="tag">–°–∫–æ—Ä–æ—Å—Ç—å: <b id="speedLabel">1√ó</b></span>
          <button class="btn-acc" data-speed="1">1√ó</button>
          <button class="btn-acc" data-speed="2">2√ó</button>
          <button class="btn-acc" data-speed="4">4√ó</button>
        </div>
      </div>

      <div class="card">
        <h2>–ê–ø–≥—Ä–µ–π–¥—ã (–¥—ë—à–µ–≤–æ –∏ —Å–µ—Ä–¥–∏—Ç–æ)</h2>
        <div id="upg" class="row" style="gap:10px;flex-wrap:wrap"></div>
        <div class="hint" style="margin-top:6px">–ü–æ–±–µ–¥–∞: –Ω–∞–∫–æ–ø–∏ <b>100</b> –°–ª–∞–≤—ã –∏ –Ω–∞–∂–º–∏ ¬´–ü—Ä–æ–≤–æ–∑–≥–ª–∞—Å–∏—Ç—å –ì—Ä–µ—á–µ—Å–∫–∏–π –†–∞–∑—É–º¬ª.</div>
        <div class="row" style="margin-top:8px">
          <button id="btn-win" class="btn-ok" disabled>–ü—Ä–æ–≤–æ–∑–≥–ª–∞—Å–∏—Ç—å –ì—Ä–µ—á–µ—Å–∫–∏–π –†–∞–∑—É–º üß†</button>
        </div>
      </div>

      <div class="card">
        <h2>–ñ—É—Ä–Ω–∞–ª</h2>
        <div id="log" class="log"></div>
      </div>
    </div>

    <div class="right">
      <div class="card">
        <h2>–°–∏—Ç—É–∞—Ü–∏–∏ –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ</h2>
        <div class="row">
          <span class="tag">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: <b id="saveLabel">–≤–∫–ª</b></span>
          <span class="tag">–ì–æ–¥ —Å—É–ø–∞: <b id="year">0</b></span>
          <span class="tag">–û—Ç–∫—Ä—ã—Ç–∏–π —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞: <b id="doors">0</b></span>
        </div>
        <p class="hint" style="margin-top:6px">
          –°–º–µ—à–Ω—ã–µ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ —Å–∞–º–∏ –≤—Å–ø–ª—ã–≤–∞—é—Ç: –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä, –∫–æ—Ç –°–æ–∫—Ä–∞—Ç, ¬´—á–∞—Å —á–µ—Å–Ω–æ–∫–∞¬ª, –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–≤–µ—Ç–∞, –æ—Ñ–∏—Ü–∏–∞–Ω—Ç —É—Ä–æ–Ω–∏–ª –ª–æ–∂–∫—É, –±–∞—Ä–º–µ–Ω –ø–æ–¥–ª–∏–ª —É–∑–æ. –ò–Ω–æ–≥–¥–∞ —ç—Ç–æ —Ö–æ—Ä–æ—à–æ. –ò–Ω–æ–≥–¥–∞ ‚Äî —É–≤–æ–ª—å–Ω–µ–Ω–∏–µ.
        </p>
        <h2 style="margin-top:12px">–ù–æ–≤–æ—Å—Ç–∏ –¥–Ω—è</h2>
        <div id="news" class="hint">–ü–æ–∫–∞ —Ç–∏—Ö–æ‚Ä¶ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ —Ç–∏—Ö–æ.</div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast">+1 –±—É–ª—å–æ–Ω</div>

<div id="modal" class="modal">
  <div class="box">
    <h3 id="m-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
    <p id="m-text">–¢–µ–∫—Å—Ç</p>
    <div class="row">
      <button id="m-continue" class="btn-acc">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      <button id="m-reset" class="btn-warn">–°—ã–≥—Ä–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>
  </div>
</div>

<div class="footer">¬© GREKO. –ï—Å–ª–∏ –ø–∞—Ö–Ω–µ—Ç ‚Äî —ç—Ç–æ –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–æ. –ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –ø–∞—Ö–Ω–µ—Ç ‚Äî —ç—Ç–æ –Ω–µ –º—ã.</div>

<script>
/* ====== –ü—Ä–æ—Å—Ç–∞—è –º–æ–¥–µ–ª—å –∫–ª–∏–∫–µ—Ä–∞ ====== */
const WIN_FAME = 100;

const S = {
  t:0, year:0, speed:1,
  broth: 0,       // –≤–∞–ª—é—Ç–∞
  perClick: 1,    // —Å–∫–æ–ª—å–∫–æ —Å –∫–ª–∏–∫–∞
  auto: 0,        // –∞–≤—Ç–æ-–¥–æ—Ö–æ–¥ –≤ —Å–µ–∫
  smell: 0,       // 0..100
  risk: 0,        // 0..100
  fame: 0,        // –ø—Ä–æ–≥—Ä–µ—Å—Å –∫ –ø–æ–±–µ–¥–µ
  doors: 0,
  enzymes:false, enzTimer:0,
  upgrades:{},
  events:0
};

const UPG = [
  {id:'olive',  name:'–î–æ–±–∞–≤–∏—Ç—å –æ–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ',     cost:20,  desc:'+1 –∫ –±—É–ª—å–æ–Ω—É –∑–∞ –∫–ª–∏–∫. –ü–∞—Ö–Ω–µ—Ç –∫—É–ª—å—Ç—É—Ä–Ω–µ–µ.', apply:()=>S.perClick+=1},
  {id:'garlic', name:'–ß–∞—Å —á–µ—Å–Ω–æ–∫–∞',                  cost:35,  desc:'+0.5 –∞–≤—Ç–æ/—Å, –Ω–æ –∑–∞–ø–∞—Ö —Ä–∞—Å—Ç—ë—Ç –±—ã—Å—Ç—Ä–µ–µ.',   apply:()=>{S.auto+=0.5; g.mod.smellMul*=1.15}},
  {id:'lazy',   name:'–ù–∞–Ω—è—Ç—å –ø–æ–≤–∞—Ä–∞-–ª–µ–Ω–∏–≤—Ü–∞',        cost:60,  desc:'+1 –∞–≤—Ç–æ/—Å, –∏–Ω–æ–≥–¥–∞ —Ä–æ–Ω—è–µ—Ç –ª–æ–∂–∫—É.',          apply:()=>{S.auto+=1; g.mod.dropSpoon=true}},
  {id:'bio',    name:'–ë–∏–æ–∫—É–ø–æ–ª –Ω–∞ –∫–∞—Å—Ç—Ä—é–ª—é',         cost:80,  desc:'–ó–∞–ø–∞—Ö –º–µ–¥–ª–µ–Ω–Ω–µ–µ –Ω–∞ 20%.',                  apply:()=>g.mod.smellMul*=0.8},
  {id:'rebrand',name:'–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Å—É–ø –≤ ¬´–î–∑–∞–¥–∑–∏–∫–∏¬ª',cost:90, desc:'–†–∏—Å–∫ –æ—Ç –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–∞ –ø–∞–¥–∞–µ—Ç —Å–∏–ª—å–Ω–µ–µ.',        apply:()=>g.mod.inspector*=0.6},
  {id:'uzou',   name:'–ë–∞—Ä–º–µ–Ω –ø–æ–¥–ª–∏–≤–∞–µ—Ç —É–∑–æ',         cost:110, desc:'+2 –∞–≤—Ç–æ/—Å, –Ω–æ –ø–µ—Ä—Å–æ–Ω–∞–ª —à—É—Ç–∏—Ç –≥—Ä–æ–º—á–µ.',     apply:()=>S.auto+=2},
  {id:'perf',   name:'–ü–∞—Ä—Ñ—é–º –∏–∑ —Ä–∞—Å—Å–æ–ª–∞',            cost:130, desc:'–ß–∞—Å—Ç—å –∑–∞–ø–∞—Ö–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –±—É–ª—å–æ–Ω.',      apply:()=>g.mod.smellToBroth=true},
];

const g = { // –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏ —Ç–∞–π–º–µ—Ä—ã —Å–æ–±—ã—Ç–∏–π
  mod:{smellMul:1, inspector:1, smellToBroth:false, dropSpoon:false},
  doorTimer:0, randTimer:0
};

function f(n){ return n>=1e6? (n/1e6).toFixed(2)+'–º' : n>=1e3? (n/1e3).toFixed(2)+'–∫' : Math.floor(n); }
function clamp(n,a,b){return Math.max(a,Math.min(b,n));}

const ui = {
  n: id=>document.getElementById(id),
  stage: document.getElementById('stage'),
  pot: document.getElementById('pot'),
  toast: document.getElementById('toast'),
  upg: document.getElementById('upg'),
  log: document.getElementById('log'),
  news: document.getElementById('news'),
  modal: document.getElementById('modal'),
  mt: document.getElementById('m-title'),
  mx: document.getElementById('m-text')
};

function log(t){ ui.log.textContent = '‚Ä¢ '+t+'\n' + ui.log.textContent; ui.news.textContent = t; }

function drawUpgrades(){
  ui.upg.innerHTML='';
  UPG.forEach(u=>{
    const have = !!S.upgrades[u.id];
    const btn = document.createElement('button');
    btn.className='btn-acc';
    btn.innerHTML = `${u.name} <span class="cost">üç≤ ${u.cost}</span>`;
    btn.disabled = have || S.broth<u.cost;
    btn.title = u.desc;
    btn.addEventListener('click',()=>{
      if (S.broth>=u.cost && !S.upgrades[u.id]){
        S.broth-=u.cost; S.upgrades[u.id]=true; u.apply(); S.fame+=5;
        document.getElementById('st-upg').textContent = Object.keys(S.upgrades).length;
        log(`–ê–ø–≥—Ä–µ–π–¥: ${u.name}. ${u.desc}`);
        refresh();
        save();
      }
    });
    if (have){ btn.disabled=true; btn.style.opacity=.6; btn.textContent=u.name+' ‚Äî ‚úî'; }
    ui.upg.appendChild(btn);
  });
}

/* –ë—É–ª—å–æ–Ω/–∫–ª–∏–∫ */
function stir(){
  const gain = S.perClick;
  S.broth += gain;
  S.smell = clamp(S.smell + 0.6, 0, 100);
  popToast(`+${gain} –±—É–ª—å–æ–Ω`);
  ui.pot.classList.add('shake'); setTimeout(()=>ui.pot.classList.remove('shake'),300);
  spawnBubble();
  refresh();
}

function spawnBubble(){
  const b = document.createElement('div');
  b.className='bubble';
  b.style.left = (45 + Math.random()*10) + '%';
  b.style.setProperty('--x', (Math.random()*60-30)+'px');
  ui.stage.appendChild(b);
  setTimeout(()=>b.remove(), 2400);
}
function popToast(txt){
  ui.toast.textContent = txt;
  ui.toast.classList.add('show');
  setTimeout(()=>ui.toast.classList.remove('show'),600);
}

function refresh(){
  ui.n('st-broth').textContent = f(S.broth);
  ui.n('st-smell').textContent = Math.round(S.smell)+'%';
  ui.n('st-risk').textContent = Math.round(S.risk)+'%';
  ui.n('st-fame').textContent = Math.floor(S.fame);
  ui.n('bar-smell').style.width = S.smell+'%';
  ui.n('bar-risk').style.width = S.risk+'%';
  ui.n('bar-fame').style.width = clamp(S.fame/WIN_FAME*100,0,100)+'%';
  ui.n('rate-broth').textContent = `+${S.perClick}/–∫–ª–∏–∫ ‚Ä¢ +${S.auto.toFixed(1)}/—Å`;
  ui.n('st-upg').textContent = Object.keys(S.upgrades).length;
  ui.n('st-events').textContent = S.events;
  document.getElementById('btn-win').disabled = S.fame<WIN_FAME || S.risk>=100;
  document.getElementById('speedLabel').textContent = S.speed+'√ó';
  document.getElementById('btn-enz').textContent = `–≠–Ω–∑–∏–º–Ω–∞—è —Ä–∞—Å–∫–∞—á–∫–∞: ${S.enzymes?'–≤–∫–ª':'–≤—ã–∫–ª'}${S.enzymes?` (${Math.ceil(S.enzTimer/1000)}—Å)`:''}`;
}

/* –°–æ–±—ã—Ç–∏—è */
function maybeDoor(dt){
  g.doorTimer -= dt*S.speed;
  if (g.doorTimer<=0){
    g.doorTimer = 15000 + Math.random()*15000;
    if (Math.random()<0.5){
      S.doors++;
      const delta = Math.max(2, 6 + S.smell*0.25) * (g.mod.inspector);
      S.risk = clamp(S.risk + delta,0,100);
      log('–û—Ç–∫—Ä—ã–ª–∏ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫. –ö—Ç–æ-—Ç–æ –Ω—é—Ö–∞–µ—Ç —Å—É–ø —Å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º ¬´–∞ —á—Ç–æ —ç—Ç–æ —É –Ω–∞—Å —Ç—É—Ç?¬ª');
    }
  }
}
function randomFunny(dt){
  g.randTimer -= dt*S.speed;
  if (g.randTimer<=0){
    g.randTimer = 9000 + Math.random()*11000;
    // –æ–¥–∏–Ω –∏–∑ —Å–æ–±—ã—Ç–∏–π
    const r = Math.random(); S.events++;
    if (r<0.20){
      S.broth += 10; log('–ö–æ—Ç –°–æ–∫—Ä–∞—Ç –æ–±–ª–∏–∑–∞–ª –∫—Ä—ã—à–∫—É. –ö–æ—Ç—ã ‚Äî —ç—Ç–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥. +10 –±—É–ª—å–æ–Ω–∞');
    }else if (r<0.40){
      S.smell = clamp(S.smell + 8,0,100); log('¬´–ß–∞—Å —á–µ—Å–Ω–æ–∫–∞¬ª: –ø–æ–≤–∞—Ä –≤–¥–æ—Ö–Ω–æ–≤–∏–ª—Å—è. –ó–∞–ø–∞—Ö –ø–æ–ø–æ–ª–∑ –∫ –∑–∞–ª—É.');
    }else if (r<0.55){
      S.risk = clamp(S.risk + 12,0,100); log('–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –∑–∞–≥–ª—è–Ω—É–ª: ¬´–ü–∞—Ö–Ω–µ—Ç‚Ä¶ –∂–∏–∑–Ω—å—é¬ª. –†–∏—Å–∫ —Ä–∞—Å—Ç—ë—Ç.');
    }else if (r<0.70){
      if (g.mod.dropSpoon){ S.broth += 5; log('–ü–æ–≤–∞—Ä-–ª–µ–Ω–∏–≤–µ—Ü —É—Ä–æ–Ω–∏–ª –ª–æ–∂–∫—É –≤ —Å—É–ø. –ù—É‚Ä¶ –≤–∫—É—Å–Ω–µ–µ –∂–µ? +5 –±—É–ª—å–æ–Ω–∞'); }
      else { log('–û—Ñ–∏—Ü–∏–∞–Ω—Ç —Ä–µ–ø–µ—Ç–∏—Ä—É–µ—Ç –ø–∞–¥–µ–Ω–∏–µ –ª–æ–∂–∫–∏, –Ω–æ –±–µ–∑ —ç–Ω—Ç—É–∑–∏–∞–∑–º–∞.'); }
    }else if (r<0.85){
      S.fame += 6; log('–ë–∞–±—É—à–∫–∞ –∏–∑ –∑–∞–ª–∞ —Å–∫–∞–∑–∞–ª–∞ ¬´–∫–∞–∫ –≤ –º–æ–ª–æ–¥–æ—Å—Ç–∏¬ª. +6 –∫ —Å–ª–∞–≤–µ');
    }else{
      // –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–≤–µ—Ç–∞ ‚Äî –∑–∞–ø–∞—Ö —Å–ª–µ–≥–∫–∞ –ø–∞–¥–∞–µ—Ç, —Ä–∏—Å–∫ —Ç–æ–∂–µ
      S.smell = clamp(S.smell - 6,0,100);
      S.risk = clamp(S.risk - 6,0,100);
      log('–û—Ç–∫–ª—é—á–∏–ª–∏ —Å–≤–µ—Ç. –í—Å–µ –¥–µ–ª–∞—é—Ç –≤–∏–¥, —á—Ç–æ —Ç–∞–∫ –∏ –±—ã–ª–æ. –ó–∞–ø–∞—Ö –∏ —Ä–∏—Å–∫ —Å–Ω–∏–∂–∞—é—Ç—Å—è.');
    }
    confetti(12);
  }
}

/* –≠–Ω–∑–∏–º–Ω—ã–π —Ä–µ–∂–∏–º */
function toggleEnz(){
  if (!S.enzymes){
    if (S.broth>=5){
      S.broth-=5; S.enzymes=true; S.enzTimer=15000; // 15 —Å–µ–∫
      log('–≠–Ω–∑–∏–º—ã –∑–∞–ø—É—â–µ–Ω—ã. –ö—É—Ö–Ω—è –∑–≤—É—á–∏—Ç –∫–∞–∫ –¥–∂–∞–∑.');
    }
  }else{
    S.enzymes=false; log('–≠–Ω–∑–∏–º–Ω–∞—è –≤–µ—á–µ—Ä–∏–Ω–∫–∞ –∫–æ–Ω—á–∏–ª–∞—Å—å. –í—Å–µ —Ä–∞–∑–æ—à–ª–∏—Å—å –Ω—é—Ö–∞—Ç—å –æ–ª–∏–≤–∫–∏.');
  }
  refresh();
}

/* –ê–≤—Ç–æ-–ø—Ä–∏–±—ã–ª—å –∏ –ø–∞—Å—Å–∏–≤—ã */
function tick(dt){
  S.t += dt*S.speed;

  // –∞–≤—Ç–æ-–±—É–ª—å–æ–Ω
  let autoRate = S.auto;
  if (S.enzymes){ autoRate*=1.6; S.smell = clamp(S.smell + 0.8*dt/1000*60,0,100); S.enzTimer-=dt*S.speed; if (S.enzTimer<=0){ S.enzymes=false; log('–≠–Ω–∑–∏–º—ã —É—Å—Ç–∞–ª–∏.'); } }
  S.broth += autoRate * dt/1000;

  // –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–ø–∞—Ö–∞ –≤ –±—É–ª—å–æ–Ω (–ø–µ—Ä—Ñ—é–º)
  if (g.mod.smellToBroth && S.smell>5){
    const s = 0.002 * S.smell * dt/1000;
    S.smell = Math.max(0, S.smell - s*0.8);
    S.broth += s*4;
  }

  // —Ä–∏—Å–∫ —Ä–∞—Å—Ç—ë—Ç –æ—Ç –∑–∞–ø–∞—Ö–∞
  S.risk = clamp(S.risk + (S.smell*0.01*g.mod.smellMul) * dt/1000, 0, 100);

  // –¥–≤–µ—Ä—å/—Ä–∞–Ω–¥–æ–º
  maybeDoor(dt);
  randomFunny(dt);

  // —Å–ª–∞–≤–∞ –º–µ–¥–ª–µ–Ω–Ω–æ –∫–∞–ø–∞–µ—Ç, –µ—Å–ª–∏ —Ä–∏—Å–∫ < 60
  if (S.risk<60) S.fame += 0.02 * dt/1000 * 60;

  // –≥–æ–¥—ã —Å—É–ø–∞
  if (Math.floor(S.t/10000)>S.year){ S.year++; }

  refresh();
  if (S.risk>=100){ endLose(); }
}

/* –ü–æ–±–µ–¥–∞/–ø–æ—Ä–∞–∂–µ–Ω–∏–µ */
function endLose(){
  showModal('–°–ª–∏—Ç—ã –≤ —É–Ω–∏—Ç–∞–∑ üíßüöΩ',
    `<span class="danger">–ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –≤–∑–¥–æ—Ö–Ω—É–ª, –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –∑–∞–ø–ª–∞–∫–∞–ª, –∞ –∫–∞—Å—Ç—Ä—é–ª—é‚Ä¶ –Ω—É —Ç—ã –ø–æ–Ω—è–ª.</span><br><br>
     –ò—Ç–æ–≥–∏: –°–ª–∞–≤–∞ ${Math.floor(S.fame)}, –∞–ø–≥—Ä–µ–π–¥–æ–≤ ${Object.keys(S.upgrades).length}, —Å–æ–±—ã—Ç–∏–π ${S.events}.`);
}
function tryWin(){
  if (S.fame>=WIN_FAME && S.risk<100){
    showModal('–ü–û–ë–ï–î–ê! –ì—Ä–µ—á–µ—Å–∫–∏–π –†–∞–∑—É–º –ø—Ä–æ–±—É–¥–∏–ª—Å—è üß†üá¨üá∑',
      `<span class="win">–°—É–ø –ø—Ä–∏–∑–Ω–∞–Ω —à–µ–¥–µ–≤—Ä–æ–º. –ú—ã –ø–æ–≤–µ—Å–∏–ª–∏ —Ç–∞–±–ª–∏—á–∫—É ¬´–ù–µ –≤—ã–ª–∏–≤–∞—Ç—å, —Ç–æ–ª—å–∫–æ –º–æ–ª–∏—Ç—å—Å—è¬ª.</span><br><br>
       –ò—Ç–æ–≥–∏: –°–ª–∞–≤–∞ ${Math.floor(S.fame)}, –ë—É–ª—å–æ–Ω ${f(S.broth)}, —Å–æ–±—ã—Ç–∏–π ${S.events}.`);
  }
}
function showModal(title, html){
  ui.mt.textContent=title; ui.mx.innerHTML=html; document.getElementById('modal').style.display='grid';
}
function hideModal(){ document.getElementById('modal').style.display='none'; }

/* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ (–º–∏–Ω–∏–º–∞–ª) */
function confetti(n=20){
  for(let i=0;i<n;i++){
    const s=document.createElement('div');
    Object.assign(s.style,{
      position:'fixed', left:(Math.random()*100)+'%', top:'-10px',
      width:'6px', height:'10px', background:['#73f0ff','#9affb1','#ffd36d','#ff9b7c'][i%4],
      transform:`rotate(${Math.random()*360}deg)`,
      borderRadius:'2px', zIndex:9999, opacity:1, transition:'transform 1.2s linear, top 1.2s linear, opacity 1.2s'
    });
    document.body.appendChild(s);
    requestAnimationFrame(()=>{
      s.style.top='110%';
      s.style.transform=`translateY(90vh) rotate(${720+Math.random()*720}deg)`;
      s.style.opacity=0.8;
    });
    setTimeout(()=>s.remove(),1300);
  }
}

/* –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ */
const KEY='greko-clicker-save';
function save(){ localStorage.setItem(KEY, JSON.stringify(S)); document.getElementById('saveLabel').textContent='–≤–∫–ª'; }
function load(){
  try{ const raw=localStorage.getItem(KEY); if(!raw) return; const o=JSON.parse(raw); Object.assign(S,o); }catch(e){}
}

/* UI bind */
document.getElementById('btn-stir').onclick=stir;
document.getElementById('btn-enz').onclick=toggleEnz;
document.getElementById('btn-win').onclick=tryWin;
document.getElementById('btn-reset').onclick=()=>{ if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?')){ localStorage.removeItem(KEY); location.reload(); } };
document.getElementById('btn-pause').onclick=(e)=>{ if(S.speed>0){S._ps=S.speed;S.speed=0;e.target.textContent='–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å'}else{S.speed=S._ps||1;e.target.textContent='–ü–∞—É–∑–∞'} };
document.getElementById('m-continue').onclick=()=>hideModal();
document.getElementById('m-reset').onclick=()=>{ localStorage.removeItem(KEY); location.reload(); };
Array.from(document.querySelectorAll('[data-speed]')).forEach(b=>b.onclick=()=>{ S.speed=Number(b.dataset.speed); document.getElementById('speedLabel').textContent=S.speed+'√ó'; });

/* init */
load(); drawUpgrades(); refresh(); log('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ GREKO. –ú—ã –Ω–µ –∫–ª–∞–¥—ë–º ¬´–ª—é–±–æ–≤—å¬ª ‚Äî —É –Ω–∞—Å –∫–æ–Ω—á–∏–ª–∞—Å—å –Ω–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ.');

let last=performance.now();
function loop(now){ const dt=now-last; last=now; if(S.speed>0){ tick(dt); if(Math.floor(S.t)%4000===0) save(); } requestAnimationFrame(loop); }
requestAnimationFrame(loop);
</script>
</body>
</html>
