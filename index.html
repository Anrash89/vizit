<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GREKO: –°–ª–∞–¥–∫–∏–π –ë–æ–π ‚Äî –ö–æ–Ω—Ñ–µ—Ç—á–∏–∫ –ø—Ä–æ—Ç–∏–≤ –≤—Å–µ—Ö</title>
<style>
  :root{
    --bg1:#071428; --bg2:#0b1f3f; --ink:#eaf2ff; --muted:#9fb3d8;
    --line:#274170; --card:#0e1f3d; --accent:#73f0ff; --accent2:#9affb1; --gold:#ffd36d;
    --ok:#32d39c; --warn:#ff9b7c; --danger:#ff5670;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; color:var(--ink); font:16px/1.45 system-ui,Segoe UI,Roboto,Arial;
    background:
      radial-gradient(1200px 700px at 70% -10%, #18335e 0%, transparent 60%),
      radial-gradient(900px 500px at -10% 30%, #142a4f 0%, transparent 60%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    background-attachment:fixed; overflow:hidden;
  }
  header{
    display:flex; align-items:center; justify-content:space-between; gap:16px;
    padding:12px 14px; border-bottom:1px solid var(--line);
  }
  .title{display:flex; gap:12px; align-items:center}
  .logo{width:44px;height:44px;border-radius:12px;
    background:
      radial-gradient(circle at 35% 35%, #ffd36d 0 40%, #b65c00 42% 48%, transparent 50%),
      conic-gradient(#ffaa00,#ff7b00,#ff4d00,#ffaa00);
    box-shadow:0 0 22px rgba(255,209,109,.35), 0 6px 18px #0008; border:1px solid #ffb13f66;
  }
  h1{margin:0;font-size:18px;letter-spacing:.4px}
  .neon{
    color:var(--accent);
    text-shadow:0 0 6px rgba(115,240,255,.9),0 0 16px rgba(115,240,255,.6),0 0 28px rgba(115,240,255,.35);
    animation:glow 3s ease-in-out infinite;
  }
  @keyframes glow{0%,100%{filter:drop-shadow(0 0 0 rgba(115,240,255,.6))}50%{filter:drop-shadow(0 0 10px rgba(115,240,255,.9))}}
  .sub{font-size:12px;color:var(--muted)}

  .hud{
    position:fixed; left:12px; top:64px; display:flex; gap:10px; align-items:center; z-index:5;
    background:#0b1730aa; border:1px solid var(--line); border-radius:12px; padding:6px 10px; backdrop-filter:blur(2px)
  }
  .bar{height:12px;background:#0b1730;border:1px solid var(--line);border-radius:999px;overflow:hidden;width:160px}
  .bar > i{display:block;height:100%; background:linear-gradient(90deg,var(--accent),#58ffa3)}
  .bar.danger>i{background:linear-gradient(90deg,#ffb37b,#ff6b6b)}
  .tag{padding:4px 8px;border:1px solid var(--line);border-radius:999px;font-size:12px;color:#c6d6f5}

  .panel{
    position:fixed; right:12px; top:64px; z-index:5; display:flex; gap:6px; flex-wrap:wrap;
  }
  .btn{
    cursor:pointer; border:1px solid var(--line); background:#0d1830; color:var(--ink);
    padding:8px 10px; border-radius:10px; font-weight:800; box-shadow:0 3px 12px #0007;
  }
  .btn:hover{filter:brightness(1.1)}
  .btn-warn{background:#2c1620;border-color:#5a2942}
  .btn-acc{background:#0c2232;border-color:#1c405a}
  .btn-ok{background:#11281f;border-color:#2f5a41}

  .wrap{position:relative; width:100%; height:calc(100% - 72px)}
  canvas{position:absolute; inset:0; width:100%; height:100%}

  .toast{
    position:fixed; left:50%; top:18px; transform:translateX(-50%);
    background:#0b1830; border:1px solid var(--line); padding:10px 14px; border-radius:12px;
    font-weight:800; box-shadow:0 10px 30px #0009; opacity:0; pointer-events:none;
    transition:.3s opacity, .3s transform; z-index:10;
  }
  .toast.show{opacity:1; transform:translateX(-50%) translateY(4px)}

  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(6,10,20,.65);backdrop-filter:blur(3px);z-index:20}
  .box{max-width:640px;background:#0e1f3d;border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:0 16px 44px #000a}
  .box h3{margin:.2rem 0 .4rem}
  .hint{color:var(--muted)}

  /* –ú–æ–±–∏–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
  .mobile{
    position:fixed; bottom:14px; left:14px; right:14px; display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:10px; z-index:6;
  }
  .mb{background:#0b1730b0; border:1px solid var(--line); border-radius:12px; padding:16px; text-align:center; font-weight:900; box-shadow:0 8px 24px #0008; user-select:none}
  .noselect{user-select:none;-webkit-user-select:none}
  @media (min-width:900px){ .mobile{display:none} }
</style>
</head>
<body>
<header>
  <div class="title">
    <div class="logo"></div>
    <div>
      <h1 class="neon">GREKO: –°–õ–ê–î–ö–ò–ô –ë–û–ô ‚Äî –ö–æ–Ω—Ñ–µ—Ç—á–∏–∫ –∏–¥—ë—Ç –≤–ø–µ—Ä—ë–¥</h1>
      <div class="sub">–ò–¥–∏ –Ω–∞–ø—Ä–∞–≤–æ, —Ä–∞–∑–¥–∞–≤–∞–π <b>—É–¥–∞—Ä—ã –Ω–æ–≥–æ–π</b>, —Å–æ–±–∏—Ä–∞–π —á–∞–µ–≤—ã–µ –∏ —à—É—Ç–∏. –§–∏–Ω–∞–ª—å–Ω—ã–π –±–æ—Å—Å ‚Äî –î–∏—Ä–µ–∫—Ç–æ—Ä –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞.</div>
    </div>
  </div>
  <div class="panel">
    <button class="btn btn-acc" id="btn-start">–°—Ç–∞—Ä—Ç</button>
    <button class="btn btn-acc" id="btn-pause">–ü–∞—É–∑–∞</button>
    <button class="btn btn-warn" id="btn-restart">–†–µ—Å—Ç–∞—Ä—Ç</button>
  </div>
</header>

<div class="hud noselect">
  <span class="tag">–î–∏—Å—Ç–∞–Ω—Ü–∏—è: <b id="dist">0–º</b></span>
  <span class="tag">–ß–∞–µ–≤—ã–µ: <b id="tips">0</b></span>
  <span class="tag">–í–æ–ª–Ω–∞: <b id="wave">1</b></span>
  <div class="tag">–ó–¥–æ—Ä–æ–≤—å–µ&nbsp;</div>
  <div class="bar danger"><i id="hpbar" style="width:100%"></i></div>
</div>

<div class="wrap"><canvas id="c"></canvas></div>

<div class="mobile">
  <div class="mb" id="mv-left">‚Üê</div>
  <div class="mb" id="mv-right">‚Üí</div>
  <div class="mb" id="mv-jump">‚Üë</div>
  <div class="mb" id="mv-kick">ü¶µ</div>
</div>

<div class="toast" id="toast">+1</div>

<div class="modal" id="modal">
  <div class="box">
    <h3 id="m-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ GREKO!</h3>
    <p id="m-text" class="hint">
      –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: <b>A/‚Üê</b> –∏ <b>D/‚Üí</b> ‚Äî —Ö–æ–¥—å–±–∞, <b>W/‚Üë</b> ‚Äî –ø—Ä—ã–∂–æ–∫, <b>Space</b> ‚Äî —É–¥–∞—Ä –Ω–æ–≥–æ–π, <b>P</b> ‚Äî –ø–∞—É–∑–∞.<br>
      –†–∞–∑–±–µ—Ä–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω: –ø–æ–≤–∞—Ä–∞, –æ—Ñ–∏—Ü–∏–∞–Ω—Ç—ã, –≤—Ä–µ–¥–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã‚Ä¶ –í —Ñ–∏–Ω–∞–ª–µ –≤—ã–π–¥–µ—Ç <b>–î–∏—Ä–µ–∫—Ç–æ—Ä –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞</b> ‚Äî –¥–µ—Ä–∂–∏—Å—å!
    </p>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn btn-ok" id="m-go">–ü–æ–µ—Ö–∞–ª–∏!</button>
      <button class="btn btn-warn" id="m-close">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<script>
/* ==========================================================
   GREKO: –°–ª–∞–¥–∫–∏–π –ë–æ–π ‚Äî —á–∏—Å—Ç—ã–π Canvas, –±–µ–∑ –∞—Å—Å–µ—Ç–æ–≤
   by you + a friendly AI. –í—Å–µ —Ä–∏—Å—É–µ—Ç—Å—è –∫–æ–¥–æ–º.
   ========================================================== */

const DPR = Math.min(2, window.devicePixelRatio || 1);
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

function resize(){
  const w = canvas.clientWidth, h = canvas.clientHeight;
  canvas.width = Math.floor(w * DPR);
  canvas.height = Math.floor(h * DPR);
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', resize);
resize();

/* ---------- –£—Ç–∏–ª–∏—Ç—ã ---------- */
const rand = (a,b)=>a+Math.random()*(b-a);
const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));
const ease=(t)=>t<.5?2*t*t:-1+(4-2*t)*t;

function sfx(type){
  try{
    const ac = sfx.ac||(sfx.ac=new (window.AudioContext||window.webkitAudioContext)());
    const o = ac.createOscillator(), g = ac.createGain();
    o.connect(g); g.connect(ac.destination);
    const preset = {
      kick:[220,0.05,0.12], hit:[440,0.02,0.08], hurt:[110,0.04,0.25],
      coin:[880,0.03,0.1], win:[660,0.04,0.5]
    }[type] || [330,0.03,0.12];
    o.frequency.value=preset[0]; g.gain.value=preset[1];
    o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime+preset[2]); o.stop(ac.currentTime+preset[2]);
  }catch(e){}
}

function toast(t){
  const el = document.getElementById('toast');
  el.textContent = t; el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),600);
}

/* ---------- –ò–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã ---------- */
const G = {
  started:false, paused:false, t:0, dt:0,
  camX:0, dist:0, tips:0, wave:1,
  ground:0, width:0, height:0, bossSpawned:false, gameOver:false, win:false
};

const input = {left:false,right:false,up:false,attack:false};

const player = {
  x:40, y:0, vx:0, vy:0, w:36, h:64, face:1,
  onGround:false, hp:100, maxHp:100, inv:0,
  state:'idle', kickT:0
};

const enemies = []; const particles = []; const texts = [];

function addText(x,y,msg,col='#eaf2ff'){ texts.push({x,y,msg,life:1,col}) }
function addParticle(x,y,col){ particles.push({x,y,vx:rand(-1,1),vy:rand(-2,-0.5),life:1,col}) }

function spawnEnemy(type, x){
  const base = {type, x, y:0, vx:-rand(0.8,1.6), w:34, h:56, hp:20, maxHp:20, dmg:8, cd:0, talkT:rand(2,6), name:''};
  if (type==='chef'){ base.w=38; base.h=62; base.hp=28; base.maxHp=28; base.dmg=10; base.vx=-rand(0.6,1.1); base.name='–ü–æ–≤–∞—Ä'; }
  else if (type==='waiter'){ base.w=32; base.h=58; base.hp=18; base.maxHp=18; base.vx=-rand(1.1,1.8); base.dmg=7; base.name='–û—Ñ–∏—Ü–∏–∞–Ω—Ç'; }
  else if (type==='client'){ base.w=30; base.h=52; base.hp=14; base.maxHp=14; base.vx=-rand(0.7,1.3); base.dmg=6; base.name='–ö–ª–∏–µ–Ω—Ç'; }
  enemies.push(base);
}

function spawnBossEkaterina(x){
  const b = {type:'boss', name:'–î–∏—Ä–µ–∫—Ç–æ—Ä –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', x, y:0, vx:-1.2, w:70, h:90, hp:160, maxHp:160, dmg:14, cd:0, dashT:3, talkT:2};
  enemies.push(b);
  G.bossSpawned=true;
  say('–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞: ¬´–ö—Ç–æ —Ç—É—Ç –Ω–æ–≥–∞–º–∏ –º–∞—Ö–∞–ª? –®—Ç—Ä–∞—Ñ –≤ –≤–∏–¥–µ –ø–æ–Ω–∏!¬ª');
}

function say(line){ addText(G.camX + 360, 60, line, '#9affb1'); }

/* ---------- –û–∫—Ä—É–∂–µ–Ω–∏–µ ---------- */
function drawBackground(){
  const W=G.width, H=G.height, x=G.camX;
  ctx.save();
  // –¥–∞–ª—å–Ω—è—è —Å—Ç–µ–Ω–∞
  ctx.fillStyle='#0d1c36'; ctx.fillRect(0,0,W,H);
  // –ø–ª–∏—Ç–∫–∞
  ctx.fillStyle='#102444';
  for(let i=0;i<W;i+=40){ for(let j=0;j<H;j+=32){
    ctx.globalAlpha=0.25; ctx.fillRect(i-(x*0.05%40), j, 36, 28); ctx.globalAlpha=1;
  }}
  // –≤—ã–≤–µ—Å–∫–∞ GREKO
  const signX = 120 - (x*0.2%300);
  ctx.save();
  ctx.translate(signX,80);
  ctx.fillStyle='#0b1226'; ctx.fillRect(-20,-18,220,46); ctx.strokeStyle='#274170'; ctx.lineWidth=2; ctx.strokeRect(-20,-18,220,46);
  ctx.font='bold 20px system-ui'; ctx.fillStyle='#73f0ff';
  ctx.shadowColor='#73f0ff'; ctx.shadowBlur=20; ctx.fillText('GREKO ‚Ä¢ ŒöŒøœÖŒ∂ŒØŒΩŒ±', 0,12); ctx.shadowBlur=0;
  ctx.restore();
  // —Å—Ç–æ–ª—ã (–ø–∞—Ä–∞–ª–ª–∞–∫—Å)
  ctx.fillStyle='#14294d';
  for(let i=-100;i<W+200;i+=160){
    const px = i - (x*0.45%160);
    ctx.fillRect(px, H-120, 120, 10); // —Å—Ç–æ–ª–µ—à–Ω–∏—Ü–∞
    ctx.fillRect(px+8, H-110, 10, 50);
    ctx.fillRect(px+100, H-110, 10, 50);
  }
  // –ø–æ–ª
  ctx.fillStyle='#0a152c'; ctx.fillRect(0,H-40,W,40);
  ctx.strokeStyle='#274170'; ctx.beginPath(); ctx.moveTo(0,H-40.5); ctx.lineTo(W,H-40.5); ctx.stroke();
  // –ø–∞—Ä –∏–∑ –∫–∞—Å—Ç—Ä—é–ª—å
  for(let i=0;i<3;i++){
    const sx = (i*220 + 40) - (x*0.2%660);
    ctx.globalAlpha=0.15; ctx.fillStyle='#eaf2ff';
    ctx.beginPath(); ctx.ellipse(sx, H-150, 30, 18, 0, 0, Math.PI*2); ctx.fill();
    ctx.globalAlpha=1;
  }
  ctx.restore();
}

function drawEntity(e){
  ctx.save(); ctx.translate(e.x-G.camX, e.y);
  // —Ç–µ–Ω—å
  ctx.fillStyle='rgba(0,0,0,.35)';
  ctx.beginPath(); ctx.ellipse(0, e.h, e.w*0.6, 8, 0, 0, Math.PI*2); ctx.fill();

  if (e===player){
    // –∫–æ–Ω—Ñ–µ—Ç—á–∏–∫ ‚Äî —à–∞–ø–æ—á–∫–∞, —Ñ–∞—Ä—Ç—É–∫, –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–æ–≥–∏
    const t = G.t*0.012, swing = e.onGround && Math.abs(e.vx)>0.1 ? Math.sin(t*8)*8 : 0;
    const kick = e.state==='kick';
    // —Ç–µ–ª–æ
    ctx.fillStyle='#1a325d'; ctx.fillRect(-12, -e.h+20, 24, e.h-20);
    // —Ñ–∞—Ä—Ç—É–∫
    ctx.fillStyle='#2b4a82'; ctx.fillRect(-14, -e.h+40, 28, 44);
    // –≥–æ–ª–æ–≤–∞
    ctx.fillStyle='#ffd7b3'; ctx.fillRect(-12, -e.h, 24, 24);
    // –∫–æ–ª–ø–∞–∫ –∫–æ–Ω–¥–∏—Ç–µ—Ä–∞
    ctx.fillStyle='#eaf2ff'; ctx.fillRect(-18, -e.h-8, 36, 10); ctx.fillRect(-12, -e.h-18, 24, 12);
    // –≥–ª–∞–∑–∞
    ctx.fillStyle='#0b1226'; ctx.fillRect(e.face>0?2:-8, -e.h+6, 4, 4);
    // —Ä—É–∫–∏
    ctx.fillStyle='#ffd7b3'; ctx.fillRect(-18, -e.h+42, 8, 16); ctx.fillRect(10, -e.h+42, 8, 16);
    // –Ω–æ–≥–∏
    ctx.fillStyle='#203b6f';
    if (kick){
      ctx.fillRect(e.face>0?10:-18, -16, 24*e.face, 8); // –Ω–æ–≥–∞-—É–¥–∞—Ä
    }else{
      ctx.save(); ctx.translate(-6, -14); ctx.rotate(swing/30); ctx.fillRect(-4, 0, 8, 14); ctx.restore();
      ctx.save(); ctx.translate(8, -14); ctx.rotate(-swing/30); ctx.fillRect(-4, 0, 8, 14); ctx.restore();
    }
    // —Å–ª–∞–¥–∫–∞—è –∫—Ä–æ—à–∫–∞
    ctx.fillStyle='#ffd36d'; ctx.fillRect(-2, -e.h+64, 4, 6);
  }else{
    // –≤—Ä–∞–≥–∏
    if (e.type==='chef'){
      ctx.fillStyle='#3a2b2b'; ctx.fillRect(-12, -e.h+20, 24, e.h-20);
      ctx.fillStyle='#ffffff'; ctx.fillRect(-14, -e.h-10, 28, 14); // –∫–æ–ª–ø–∞–∫
      ctx.fillStyle='#ffd7b3'; ctx.fillRect(-10, -e.h, 20, 20); // –ª–∏—Ü–æ
      ctx.fillStyle='#704b2a'; ctx.fillRect(10, -e.h+40, 12, 6); // —Å–∫–∞–ª–∫–∞
    }else if (e.type==='waiter'){
      ctx.fillStyle='#1b3c4a'; ctx.fillRect(-11, -e.h+20, 22, e.h-20);
      ctx.fillStyle='#ffd7b3'; ctx.fillRect(-10, -e.h, 20, 18);
      ctx.fillStyle='#c0c9ff'; ctx.fillRect(8, -e.h+26, 20, 4); // –ø–æ–¥–Ω–æ—Å
      ctx.beginPath(); ctx.arc(22, -e.h+24, 5, 0, Math.PI*2); ctx.fillStyle='#ffd36d'; ctx.fill();
    }else if (e.type==='client'){
      ctx.fillStyle='#42314a'; ctx.fillRect(-10, -e.h+20, 20, e.h-20);
      ctx.fillStyle='#ffd7b3'; ctx.fillRect(-9, -e.h+2, 18, 18);
      ctx.fillStyle='#8b9eff'; ctx.fillRect(10, -e.h+30, 10, 14); // —Å–º–∞—Ä—Ç—Ñ–æ–Ω
    }else if (e.type==='boss'){
      ctx.fillStyle='#2a2a4f'; ctx.fillRect(-e.w*0.35, -e.h+20, e.w*0.7, e.h-20);
      ctx.fillStyle='#ffd7b3'; ctx.fillRect(-18, -e.h+2, 36, 26);
      ctx.fillStyle='#ff4d7a'; ctx.fillRect(-e.w*0.35, -e.h+46, e.w*0.7, 10); // –ø–æ—è—Å-¬´–Ω–∞–∫–∞–∑¬ª
      // –ø–∞–ø–∫–∞/–∫–ª–∏–ø–±–æ—Ä–¥
      ctx.fillStyle='#ffb37b'; ctx.fillRect(e.vx<0?(-e.w*0.35-16):(e.w*0.35), -e.h+54, 16, 20);
    }
    // –ø–æ–ª–æ—Å–∫–∞ —Ö–ø
    const hpw = 40;
    ctx.fillStyle='rgba(0,0,0,.35)'; ctx.fillRect(-hpw/2, -e.h-14, hpw, 6);
    ctx.fillStyle=e.type==='boss'?'#ff6b6b':'#73f0ff';
    ctx.fillRect(-hpw/2, -e.h-14, hpw*(e.hp/e.maxHp), 6);
  }
  ctx.restore();
}

/* ---------- –°–ø–∞–≤–Ω –≤–æ–ª–Ω ---------- */
let spawnX = 400;

function trySpawn(){
  if (G.bossSpawned) return;
  if (G.dist>380 && G.wave===1){ G.wave=2; toast('–í–æ–ª–Ω–∞ 2: –æ—Ñ–∏—Ü–∏–∞–Ω—Ç—ã –≤—ã—à–ª–∏ –∏–∑ —Ç–µ–Ω–µ–π'); }
  if (G.dist>760 && G.wave===2){ G.wave=3; toast('–í–æ–ª–Ω–∞ 3: –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã —Å—á—ë—Ç–æ–º'); }
  if (G.dist>1100 && !G.bossSpawned){ spawnBossEkaterina(G.camX + 900); toast('–ë–æ—Å—Å: –¥–∏—Ä–µ–∫—Ç–æ—Ä –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –≤ –¥–µ–ª–µ!'); }

  while (spawnX < G.camX + G.width + 200){
    const t = Math.random();
    let type='chef';
    if (G.wave>=2 && t>0.4) type='waiter';
    if (G.wave>=3 && t>0.7) type='client';
    spawnEnemy(type, spawnX + rand(80,250));
    spawnX += rand(120,220);
  }
}

/* ---------- –§–∏–∑–∏–∫–∞ ---------- */
function rectsOverlap(a,b){
  return Math.abs(a.x - b.x) < (a.w*0.5 + b.w*0.5) &&
         Math.abs(a.y - b.y) < (a.h*0.5 + b.h*0.5);
}

function damagePlayer(dmg){
  if (player.inv>0 || G.gameOver) return;
  player.hp = clamp(player.hp - dmg, 0, player.maxHp);
  player.inv = 0.6; player.state='hurt'; sfx('hurt');
  for(let i=0;i<5;i++) addParticle(player.x, player.y-20, '#ff6b6b');
  if (player.hp<=0){ gameOver(false); }
}

function damageEnemy(e, dmg=18, kb=3){
  e.hp -= dmg; e.vx -= kb * Math.sign(player.face);
  for(let i=0;i<5;i++) addParticle(e.x, e.y-20, '#9affb1');
  sfx('hit');
  if (e.hp<=0){
    addText(e.x, e.y-40, '+—á–∞–µ–≤—ã–µ', '#ffd36d'); sfx('coin');
    G.tips += 5 + Math.floor(Math.random()*4);
    // —Å–º–µ—à–Ω—ã–µ —Ä–µ–ø–ª–∏–∫–∏
    const lines={
      chef:'–ü–æ–≤–∞—Ä: ¬´–ù—É –∏ –ª–∞–¥–Ω–æ, —è –∫–æ–Ω–¥–∏—Ç–µ—Ä–æ–º —Ö–æ—Ç–µ–ª –±—ã—Ç—å!¬ª',
      waiter:'–û—Ñ–∏—Ü–∏–∞–Ω—Ç: ¬´–ê –º–æ–∂–Ω–æ –±–µ–∑ –Ω–æ–≥?¬ª',
      client:'–ö–ª–∏–µ–Ω—Ç: ¬´–Ø –æ—Ç–∑—ã–≤ –Ω–∞–ø–∏—à—É‚Ä¶ –Ω–æ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ª–µ–∂—É.¬ª',
      boss:'–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞: ¬´–° –æ—Ç–ø—É—Å–∫–æ–º —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –ø–æ–∑–∂–µ‚Ä¶¬ª'
    };
    logNews(lines[e.type]||'');
    enemies.splice(enemies.indexOf(e),1);
    if (e.type==='boss'){ gameOver(true); }
  }
}

function logNews(t){ if(!t) return; addText(G.camX+360, 90, t, '#9affb1'); }

function update(dt){
  if (!G.started || G.paused || G.gameOver) return;

  // –≤—Ä–µ–º—è
  G.t += dt; G.dist += Math.max(0, player.vx)*dt*0.2;

  // –≥–∞–±–∞—Ä–∏—Ç—ã
  G.width = canvas.clientWidth; G.height = canvas.clientHeight; G.ground = G.height-40;

  // —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
  const accel = 0.8, maxv = 3.2;
  if (input.left)  player.vx = clamp(player.vx - accel, -maxv,  maxv), player.face=-1;
  if (input.right) player.vx = clamp(player.vx + accel, -maxv,  maxv), player.face= 1;
  if (!input.left && !input.right){ player.vx *= 0.85; if (Math.abs(player.vx)<0.01) player.vx=0; }

  if (input.up && player.onGround){ player.vy = -7; player.onGround=false; }
  if (input.attack && player.kickT<=0){ player.state='kick'; player.kickT=0.35; sfx('kick'); }

  // —Ñ–∏–∑–∏–∫–∞ –∏–≥—Ä–æ–∫–∞
  player.vy += 0.35; // –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
  player.x += player.vx*4;
  player.y += player.vy*2;
  if (player.y > G.ground){ player.y = G.ground; player.vy=0; player.onGround=true; }
  if (player.inv>0) player.inv -= dt;
  if (player.kickT>0){
    player.kickT -= dt;
    if (player.kickT<=0) player.state='idle';
  } else if (!player.onGround) player.state='jump';
  else if (Math.abs(player.vx)>0.2) player.state='run';
  else player.state='idle';

  // –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–ª–µ–≤–∞
  if (player.x < G.camX + 40) player.x = G.camX + 40;

  // –∫–∞–º–µ—Ä–∞
  const targetCam = player.x - G.width*0.35;
  G.camX += (targetCam - G.camX)*0.08;

  // —Å–ø–∞–≤–Ω
  trySpawn();

  // –≤—Ä–∞–≥–∏
  for (const e of enemies){
    // –¥–≤–∏–∂–µ–Ω–∏–µ
    e.vx = clamp(e.vx, -2.2, 0.6);
    e.x += (e.vx - 0.1*Math.sign(e.x-player.x)); // —á—É—Ç—å —Ç—è–Ω—É—Ç—Å—è –∫ –∏–≥—Ä–æ–∫—É
    e.y = G.ground;

    // –∞—Ç–∞–∫–∏
    e.cd -= dt;
    if (rectsOverlap({...player,w:player.w,h:player.h}, e)){
      if (e.cd<=0){ e.cd=0.8; damagePlayer(e.dmg); addText(player.x, player.y-60, '-'+e.dmg, '#ff6b6b'); }
    }

    // —Ä–µ—á—å
    e.talkT -= dt;
    if (e.talkT<=0 && Math.random()<0.25){
      e.talkT = rand(3,7);
      const lines={
        chef:['¬´–°–æ–ª—å –ø–æ –≤–∫—É—Å—É, –∞ –Ω–æ–≥–æ–π ‚Äî –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é?¬ª','¬´–≠—Ç–æ –Ω–µ –ø–æ –ì–û–°–¢—É!¬ª'],
        waiter:['¬´–¢–æ–ª—å–∫–æ –Ω–µ –≤ –ø–æ–¥–Ω–æ—Å!¬ª','¬´–°–∫–∏–¥–∫—É –ø–æ –ó–°—É –æ—Ñ–æ—Ä–º–∏–º?¬ª'],
        client:['¬´–ì–¥–µ –º–æ–π –∫–∞–ø—É—á–∏–Ω–æ –Ω–∞ –æ–≤—Å—è–Ω–æ–º?¬ª','¬´–Ø —Ç—É—Ç –ø–æ —Ñ—Ä–∏–ª–∞–Ω—Å—É –µ–º.¬ª'],
        boss:['¬´–û—Ç—á—ë—Ç –Ω–∞ —Å—Ç–æ–ª!¬ª','¬´–ö—Ç–æ —Å—ä–µ–ª –≥—Ä–µ—á–µ—Å–∫–∏–π —Å–∞–ª–∞—Ç –±–µ–∑ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è?¬ª']
      }[e.type]||['–≠–º‚Ä¶'];
      addText(e.x, e.y- e.h - 24, lines[Math.floor(Math.random()*lines.length)], '#c6d6f5');
    }
  }

  // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —É–¥–∞—Ä–∞ –Ω–æ–≥–æ–π
  if (player.state==='kick'){
    const foot = {x:player.x + player.face*30, y:player.y-20, w:26, h:20};
    for (const e of [...enemies]){
      if (rectsOverlap(foot,e)){ damageEnemy(e, e.type==='boss'?12:22, 4); }
    }
  }

  // —á–∞—Å—Ç–∏—Ü—ã/—Ç–µ–∫—Å—Ç—ã
  for (const p of particles){ p.x+=p.vx*2; p.y+=p.vy*2; p.vy+=0.1; p.life-=dt*0.9; }
  for (const t of texts){ t.y-=0.3; t.life-=dt*0.5; }
  while(particles.length && particles[0].life<=0) particles.shift();
  while(texts.length && texts[0].life<=0) texts.shift();

  // UI
  document.getElementById('hpbar').style.width = (player.hp/player.maxHp*100)+'%';
  document.getElementById('dist').textContent = Math.floor(G.dist)+'–º';
  document.getElementById('tips').textContent = G.tips;
  document.getElementById('wave').textContent = G.wave;
}

/* ---------- –†–µ–Ω–¥–µ—Ä ---------- */
function render(){
  ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);
  drawBackground();

  // —Å—É—â–Ω–æ—Å—Ç–∏
  for (const e of enemies) drawEntity(e);
  drawEntity(player);

  // —á–∞—Å—Ç–∏—Ü—ã
  for (const p of particles){
    ctx.globalAlpha = Math.max(0, p.life);
    ctx.fillStyle = p.col || '#9affb1'; ctx.fillRect(p.x-G.camX, p.y, 4,4);
    ctx.globalAlpha = 1;
  }
  // –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ —Ç–µ–∫—Å—Ç—ã
  ctx.font='bold 14px system-ui'; ctx.textBaseline='middle';
  for (const t of texts){
    ctx.globalAlpha = Math.max(0, t.life);
    ctx.fillStyle=t.col; ctx.fillText(t.msg, t.x-G.camX, t.y);
    ctx.globalAlpha=1;
  }

  // —Ö–∏—Ç–±–æ–∫—Å —É–¥–∞—Ä–∞ (–º–∏–≥–Ω—ë–º)
  if (player.state==='kick' && player.kickT>0.15){
    const x = player.x + player.face*30, y = player.y-20;
    ctx.globalAlpha=0.25; ctx.fillStyle='#9affb1'; ctx.fillRect(x-13-G.camX, y-10, 26, 20); ctx.globalAlpha=1;
  }
}

/* ---------- –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª ---------- */
let last=performance.now();
function loop(now){
  const dt = Math.min(0.033, (now-last)/1000); last=now;
  G.dt=dt;
  update(dt);
  render();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ---------- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ ---------- */
function gameOver(win){
  if (G.gameOver) return;
  G.gameOver=true; G.win=win;
  const modal = document.getElementById('modal');
  const t = document.getElementById('m-title'), m=document.getElementById('m-text');
  if (win){
    t.textContent='–ü–û–ë–ï–î–ê! –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –æ—Ç—Å—Ç—É–ø–∏–ª–∞ üßÅüë†';
    m.innerHTML=`–¢—ã –ø—Ä–æ—à—ë–ª –∫—É—Ö–Ω—é GREKO. –ß–∞–µ–≤—ã—Ö: <b>${G.tips}</b>, –¥–∏—Å—Ç–∞–Ω—Ü–∏—è: <b>${Math.floor(G.dist)}–º</b>.
                 <br>–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –ø–æ–æ–±–µ—â–∞–ª–∞ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å KPI –∏ –≤—ã–¥–∞—Ç—å –ø—Ä–µ–º–∏—é ¬´–ó–∞ —Å–∏–ª—É –Ω–æ–≥¬ª.`;
    sfx('win'); confetti();
  }else{
    t.textContent='–ü—Ä–æ–∏–≥—Ä—ã—à ‚Äî —Ç–µ–±—è —É–≤–æ–ª–∏–ª–∏ üßæ';
    m.innerHTML=`–ó–¥–æ—Ä–æ–≤—å–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å. –ù–æ –¥—É—Ö –∫–æ–Ω–¥–∏—Ç–µ—Ä–∞ –≤–µ—á–µ–Ω. <br>–ß–∞–µ–≤—ã–µ: <b>${G.tips}</b>, –≤–æ–ª–Ω–∞: <b>${G.wave}</b>.`;
  }
  modal.style.display='grid';
}

function startGame(){
  document.getElementById('modal').style.display='none';
  G.started=true; G.paused=false; G.gameOver=false; G.win=false;
  // —Å–±—Ä–æ—Å
  enemies.length=0; particles.length=0; texts.length=0; G.camX=0; G.dist=0; G.tips=0; G.wave=1; G.bossSpawned=false; spawnX=400;
  Object.assign(player,{x:60,y:0,vx:0,vy:0,face:1,onGround:false,hp:100,inv:0,state:'idle',kickT:0});
  // –Ω–∞—á–∞–ª—å–Ω–∞—è –ø–∞—á–∫–∞ –≤—Ä–∞–≥–æ–≤
  for(let i=0;i<4;i++) spawnEnemy(['chef','waiter','client'][i%3], 380+i*160);
}

function pauseToggle(){
  if(!G.started||G.gameOver) return;
  G.paused=!G.paused;
  document.getElementById('btn-pause').textContent = G.paused?'–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å':'–ü–∞—É–∑–∞';
}

function confetti(n=80){
  for(let i=0;i<n;i++){
    const s=document.createElement('div');
    Object.assign(s.style,{
      position:'fixed', left:(Math.random()*100)+'%', top:'-10px',
      width:'6px', height:'10px', background:['#73f0ff','#9affb1','#ffd36d','#ff9b7c'][i%4],
      transform:`rotate(${Math.random()*360}deg)`, borderRadius:'2px', zIndex:9999,
      transition:'transform 1.2s linear, top 1.2s linear, opacity 1.2s'
    });
    document.body.appendChild(s);
    requestAnimationFrame(()=>{
      s.style.top='110%'; s.style.transform=`translateY(90vh) rotate(${720+Math.random()*720}deg)`; s.style.opacity=0.85;
    });
    setTimeout(()=>s.remove(),1300);
  }
}

/* ---------- –°–æ–±—ã—Ç–∏—è –≤–≤–æ–¥–∞ ---------- */
window.addEventListener('keydown', e=>{
  if (e.repeat) return;
  if (e.code==='ArrowLeft'||e.code==='KeyA') input.left=true;
  if (e.code==='ArrowRight'||e.code==='KeyD') input.right=true;
  if (e.code==='ArrowUp'||e.code==='KeyW') input.up=true;
  if (e.code==='Space'){ e.preventDefault(); input.attack=true; }
  if (e.code==='KeyP') pauseToggle();
});
window.addEventListener('keyup', e=>{
  if (e.code==='ArrowLeft'||e.code==='KeyA') input.left=false;
  if (e.code==='ArrowRight'||e.code==='KeyD') input.right=false;
  if (e.code==='ArrowUp'||e.code==='KeyW') input.up=false;
  if (e.code==='Space') input.attack=false;
});

function bindTouch(id, key){
  const el=document.getElementById(id);
  const down=()=>{ input[key]=true; el.style.filter='brightness(1.2)'; };
  const up=()=>{ input[key]=false; el.style.filter=''; };
  ['pointerdown','touchstart','mousedown'].forEach(ev=>el.addEventListener(ev,down));
  ['pointerup','pointerleave','touchend','mouseup','touchcancel'].forEach(ev=>el.addEventListener(ev,up));
}
bindTouch('mv-left','left'); bindTouch('mv-right','right'); bindTouch('mv-jump','up'); bindTouch('mv-kick','attack');

/* ---------- –ö–Ω–æ–ø–∫–∏ UI ---------- */
document.getElementById('btn-start').onclick=()=>{ startGame(); toast('–ü–æ–µ—Ö–∞–ª–∏! –£–¥–∞—Ä –Ω–æ–≥–æ–π ‚Äî Space'); };
document.getElementById('btn-restart').onclick=()=>startGame();
document.getElementById('btn-pause').onclick=pauseToggle;
document.getElementById('m-go').onclick=()=>{ startGame(); };
document.getElementById('m-close').onclick=()=>{ document.getElementById('modal').style.display='none'; };

/* –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ */
document.getElementById('modal').style.display='grid';
</script>
</body>
</html>
